#!/bin/bash

# Git stared repositories
set -eu; PATH="$(dirname "${0}"):${PATH}" && . strict.lib

star() {
  while curl -s "https://api.github.com/users/${GIT:-j5pu}/starred?per_page=100&page=${page:-1}" \
    | jq -r -e '.[].full_name' && [ "${PIPESTATUS[1]}" -ne 4 ]; do
    ((page++))
  done
}

swap() {
  local owner repo
  while IFS='/' read -r owner repo; do
    echo "${repo} ${owner}"
  done < <(star)
}

main() {
  local owner repo
  for arg do
    case "${arg}" in
      -h|--help) usage "${0}" ;;
      --desc) desc "${0}" ;;
      --version) rc.d.version ;;
      *) break ;;
    esac
  done

  while read -r repo owner; do
    echo "${owner}${arg:-;}${repo}"
  done < <(swap | command sort -u)
}

main "${@}"
