#!/bin/sh

# Show warning message with ! symbol in yellow if WARNING is set, unless QUIET is set
#
set -eu; PATH="$(dirname "${0}"):${PATH}" && . strict.lib && . ../../bin/color.lib

####################################### > warning: WARNING (default: unset), QUIET (default: unset)
# Show warning message with ! symbol in yellow if WARNING is set, unless QUIET is set
# Globals:
#   Yellow             Yellow color for warning message and ! symbol.
#   Reset              Reset color.
#   QUIET              Do not show message if set, takes precedence over WARNING (default: unset).
#   WARNING            Shows message if is set, unless QUIET is set (default: unset).
# Arguments:
#   --usage            Show help message and exit.
#   Message            Message to show in yellow with ! symbol.
# Output:
#   Message to stderr.
#######################################
for arg do
  case "${arg}" in
    -h|--help) usage "${0}" ;;
    --desc) desc "${0}" ;;
    --version) rc.d.version ;;
  esac
done

if [ ! "${QUIET-}" ]; then
  if [ "${WARNING-}" ]; then
    add=""
    if command -v caller >/dev/null; then
      c="$(caller 0)"
      add="${YellowInvert}$(basename "$(echo "${c}" | awk '{ print $3 }')")[$(echo "${c}" | awk '{ print $1 }')]\
${Reset}: "
    fi
    [ "${*-}" ] || { [ ! "${add-}" ] || add="${add%??}"; }  # if no args, remove trailing ": "
    printf '%b\n' "${YellowBold}!${Reset} ${add:-}${YellowBold}${*:-}${Reset}" >&2
    unset add c
  fi
fi


