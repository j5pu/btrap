#!/bin/sh

set -e

# TODO: Voy a usar el path de systema que tenga por defecto el git o sea, con root o sea SUDOC

# TODO: AÃ±adir mi sudo mi git y mi brew en el /opt a tomar por culo.
# TODO: Ver los paths que se instalaria los man pages y los ifo en cada systema y actualizar una variabe
# y ver si lo haria el python.
#Usar EOT para git config y para gh config y para el inputrc .

docker() {
  file="${DOCKER_CONFIG}/scan/config.json"
  config=$(cat<<EOF
{
  "path": "${scan_path}",
  "optin": true
}
EOF
  )

  file="${DOCKER_CONFIG}/scan/tokens.json"
  config=$(cat<<EOF
{
  "${GIT}": "${DOCKER_SYNC_TOKEN}"
}
EOF
  )
  run
}

run() {

  # TODO: "${3}" would be sudo. check if write permissions and sudo if sudo .
  echo "${config}" | "${1}" tee "${file}" 1>/dev/null
}

if [ "${DARWIN-}" ]; then
  scan_path="/Applications/Docker.app/Contents/Resources/snyk/docker/snyk-mac.sh"
else
  # TODO: ver como se instala en LINUX y ver si hay mas paths que se usan en docker para poner variable.
  #  poner --force y la opcion de cuantas hay
  scan_path=""
fi

  # TODO: poner function para.
