# shellcheck shell=sh

# Color library
#
dir="${RCSHARE:-/tmp}/color"
file="${dir}/color.sh"

if [ ! "${Red-}" ] || [ ! -r "${file}" ]; then
  if [ ! -r "${file}" ] || [ "${FORCE-}" ]; then
    [ -d "${dir}" ] || mkdir "${dir}"
    rm -f "${file-}"

    color() {
      co=${1}${4:-}; COLORS="${COLORS:-}${5:-}${co}"
      f="$(echo "${co}" | tr '[:upper:]' '[:lower:]')"; COLOR_FUNCS="${COLOR_FUNCS:-}${5:-}${f}"

      eval "${co}"='\033[${2}${3}'
      tee -a "${file}" > /dev/null <<EOF
# <html><h2>${1} ${4:-}</h2>
# <p><strong><code>\$${co}</code></strong> Color ${1} ${4:-}.</p>
# </html>
export ${co}='\033[${2}${3}'

# <html><h2>${f} - Show arguments in ${co}</h2>
# <h3>Examples</h3>
# <dl>
# <dt>Show arguments in ${co}:</dt>
# <dd>
# <pre><code class="language-bash">${f} Show Text
# </code></pre>
# </dd>
# </dl>
# </html>
${f}() { printf '%b' "\${${co}}\${@:-}\${Reset}"; }

EOF
    unset co f
    }

    i=0; COLORS=""
    color 'Reset' "${i}" 'm' '' ''
    for c in Black Red Green Yellow Blue Magenta Cyan Grey; do
      color "${c}" "3${i}" 'm'    ''        ' '
      color "${c}" "3${i}" ';1m'  'Bold'    ' '
      color "${c}" "3${i}" ';2m'  'Dim'     ' '
      color "${c}" "3${i}" ';4m'  'Under'   ' '
      color "${c}" "3${i}" ';7m'  'Invert'  ' '
      color "${c}" "4${i}" 'm'    'Bg'      ' '
      i="$((i+1))"
    done

          tee -a "${file}" > /dev/null <<EOF
# <html><h2>All Colors</h2>
# <p><strong><code>\$COLORS</code></strong> All colors for 'color' script and testing.</p>
# </html>
COLORS='${COLORS}'

# <html><h2>Color Functions</h2>
# <p><strong><code>\$COLOR_FUNCS</code></strong> All color functions for 'color' script and testing.</p>
# </html>
COLOR_FUNCS='${COLOR_FUNCS}'

EOF

    unset -f color
    unset c i
  fi
  . "${file}"
fi

unset dir file
