# shellcheck shell=sh

# Development library with .env support and development helper functions
#

# <html><h2>Source Development Library</h2>
# <p><strong><code>$DEV</code></strong> when set to 1 sources dev.lib.</p>
# </html>
DEV="${DEV:-0}"; export DEV

if "${DEV}" -eq 1; then
  # <html><h2>Bats Test Filename Prefix (when sourcing: bats.lib)</h2>
  # <p><strong><code>$BATS_TEST_FILENAME_PREFIX</code></strong> prefix of BATS_TEST_FILENAME basename.</p>
  # </html>
  BATS_TEST_FILENAME_PREFIX="$(basename "${BATS_TEST_FILENAME:-}" .bats)"; export BATS_TEST_FILENAME_PREFIX

  # <html><h2>Project Top Level Path</h2>
  # <p><strong><code>$PROJECT_DIR</code></strong>  contains output of 'git-top'.</p>
  # </html>
  PROJECT_DIR="${PROJECT_DIR:-$(git-top || pwd)}"; export PROJECT_DIR

fi

####################################### Executed: force & parse
#
if test "$#" -ne 0 && test "${PARSED-}"; then
  unset PARSE PARSED
  for arg do
    case "${arg}" in
      --force) FORCE=1 . "$0"
    esac
  done
elif test "$#" -ne 0; then
    PARSE="$0" parse "$@"
fi
