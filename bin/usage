#!/bin/sh

####################################### âœ“ usage: exported function
# Show man page (no pager) and die if --help or -h in arguments, checks caller filename otherwise caller function name.
# Arguments:
#   --usage             Show help message and exit.
# Output:
#   Man page with no pager to stdout.
# Returns:
#   1 if --usage.
#######################################
for arg do
  case "${arg}" in
    --usage)
      if has caller && has man; then
        # shellcheck disable=SC3044
        c="$(caller 0)"
        if [ "${c-}" ]; then
          if ! man -p cat "$(basename "$(echo "${c}" | awk '{ print $3 }')")" 2>/dev/null; then
            func="$(echo "${c}" | awk '{ print $2 }')"
            { [ "${func}" != 'main' ] && man -p cat "${func}" 2>/dev/null; } || exit 1
          fi
        elif [ "${FUNCNAME[0]-}" ]; then
          # shellcheck disable=SC3054
          man -p cat "${FUNCNAME[0]}" 2>/dev/null || exit 1
        else
          exit 1
        fi
      fi
      unset arg c func
      exit 1
      ;;
  esac
done


