#!/bin/bash
set -e

#######################################
# Docker hub build hook
# https://docs.docker.com/docker-hub/builds/advanced/
# https://dev.to/samuelea/automate-your-builds-on-docker-hub-by-writing-a-build-hook-script-13fp
# https://codeclimbing.com/automate-your-builds-on-docker-hub-by-writing-a-build-hook-script/
# SOURCE_BRANCH:      Name of the branch or the tag that is currently being tested.
# SOURCE_COMMIT:      SHA1 hash of the commit being tested.
# COMMIT_MSG:         Message from the commit being tested and built.
# DOCKER_REPO:        Name of the Docker repository being built.
# DOCKERFILE_PATH:    Dockerfile currently being built.
# DOCKER_TAG:         Docker repository tag being built.
# IMAGE_NAME:         Name and tag of the Docker repository being built.
#                     (This variable is a combination of DOCKER_REPO:DOCKER_TAG.)
#######################################
main() {
  local image tag
  while read -r image tag; do
    docker build --build-arg image="${image}" --target build --tag "${tag}" .
  done <<< "${input}"
}

####################################### Autogenerated by: images.sh
input=$(cat <<eot
alpine:latest j5pu/rc:alpine
archlinux:latest j5pu/rc:archlinux
bash:latest j5pu/rc:bash
bats/bats:latest j5pu/rc:bats
busybox:latest j5pu/rc:busybox
centos:latest j5pu/rc:centos
debian:latest j5pu/rc:debian
fedora:latest j5pu/rc:fedora
jrei/systemd-ubuntu:latest j5pu/rc:systemd-ubuntu
kalilinux/kali-rolling:latest j5pu/rc:kali-rolling
kalilinux/kali-bleeding-edge:latest j5pu/rc:kali-bleeding-edge
nixos/nix:latest j5pu/rc:nix
python:3.9-alpine j5pu/rc:python3.9
python:3.9-bullseye j5pu/rc:python3.9-bullseye
python:3.9-slim j5pu/rc:python3.9-slim
python:3.10-alpine j5pu/rc:python3.10
python:3.10-bullseye j5pu/rc:python3.10-bullseye
python:3.10-slim j5pu/rc:python3.10-slim
richxsl/rhel7:latest j5pu/rc:rhel7
ubuntu:latest j5pu/rc:ubuntu
zshusers/zsh:latest j5pu/rc:zsh
eot
)

main
